# 프로세스와 스레드

## 프로세스(Process)
메인 메모리에 할당되어 **실행중인 상태**인 프로그램을 말한다.
- 메모리에 올라와 실행되고 있는 프로그램의 인스턴스(Instance : 독립적인 개체)
- 운영체제로 부터 **시스템 자원을 할당 받는 작업의 단위**
- 동적인 개념으로는 실행된 프로그램을 의미

**할당 받는 시스템 자원의 예**
+ 운영되기 위해 필요한 주소 공간
+ CPU 시간
+ Code, Data, Heap, Stack 의 구조로 되어 있는 독립된 메모리 영역

### 프로세스(Process) vs 프로그램(Program)
> 프로그램이란? 파일 시스템에 존재하는 실행 파일이 프로그램이다. 보조기억장치에 존재하며 실행되기 기다리는 명령어와 정적인 데이터의 묶음

프로그램과 프로세스의 가장 큰 차이점은 프로그램은 지정된 작업을 수행하는 명령 그룹이며 프로세스는 실행중인 프로그램이라는 점이다. 여러 프로세스가 동일한 프로그램의 일부가 될 수 있다.

### 프로세스 상태
![image](https://user-images.githubusercontent.com/33089715/117449210-aa1f9700-af7a-11eb-866a-6dc44968eda7.png)

+ New : 프로그램이 메인 메모리에 할당된다.
+ Ready : 할당된 프로그램이 초기화와 같은 작업을 통해 실행되기 위한 모든 준비를 마친다.
+ Running : CPU가 해당 프로세스를 실행한다.
+ Waiting : 프로세스가 끝나지 않은 시점에서 I/O로 인해 CPU를 사용하지 않고 다른 작업을 한다. (해당 작업이 끝나면 다시 CPU에 의해 실행되기 위해 ready 상태로 돌아가야 한다.)
+ Terminated : 프로세스가 완전히 종료된다.

** running에서 ready로 변할 때는 time sharing system 에서 해당 프로세스가 CPU 시간을 모두 소진되었을 때 인터럽트에 의해 강제로 ready 상태로 변하고, CPU는 다른 프로세스를 실행시킨다.

### 특징
- 프로세스는 각각 독립된 메모리 영역(Code, Data, Stack, Heap 등)을 할당 받음
- 기본적으로 프로세스 당 최소 1개의 스레드(메인 스레드)를 가지고 있음
- 각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없음
- 다른 프로세스에 접근하기 위해서는 프로세스 간 통신(IPC : Inter-Process Communication)을 사용해야 함

### 프로세스 메모리 구조

- Stack : 프로그램이 자동으로 사용하는 임시 메모리 영역으로 지역변수, 매개변수, 리턴 값 등이 잠시 사용 되었다가 사라지는 데이터를 저장하는 영역이다. 함수 호출 시 생성되고 함수가 끝나면 반환된다.
- Heap : 필요에 의해 메모리를 동적 할당하고자 할 때 사용하는 메모리 영역으로 동적 데이터 영역이라고 부른다. 메모리 주소 값에 의해서만 참조되고 사용하는 영역이다. 이 영역에 데이터를 저장하기 위해 C 에서는 malloc() 함수를 사용한다.
- Data : 프로그램이 실행될 때 생성되고 프로그램이 종료되면 시스템에 반환 되며 전역 변수, 정적 변수, 배열, 구조체 등이 저장된다.

    - 함수 내부에 선언된 Static 변수는 프로그램이 실행될 때 공간만 할당되고 그 함수가 실행될 때 초기화된다.
    - 초기화 된 데이터는 Data 영역에 저장되고 초기화되지 않은 데이터는 BSS(Block Stated Symbol) 영역에 저장된다. 
        - 이유? : 프로그램을 짠 뒤 컴파일하고 링크하고 이미지로 만들어 시스템의 ROM에 저장했다고 가정해보자. 이 때 초기화된 데이터는 초기 값을 저장해야하므로 Data 영역에 저장되어 ROM에 저장된다. 하지만 초기화하지 않은 데이터까지 ROM에 저장한다면 큰 사이즈의 ROM 이 필요한데 비용이 많이 들어 RAM 에 저장하기 위해 Data 영역과 BSS 영역으로 나누었다.
- Code : 코드 자체를 구성하는 메모리 영역으로 Hex 파일이나 Bin 파일 메모리이다. 

### PCB(Process Control Block, 프로세스 제어 블록)란?
프로세스에 대한 모든 정보가 모여있는 곳이다.
+ 운영체제 내부의 프로세스를 관리하는 코드 부분에 저장되어 있다.
+ **PCB에 저장되는 정보**
    - 프로세스 식별자(Process ID, PID) : 프로세스 식별 번호
    - 프로세스 상태 : (new, ready, running, waiting, terminated) 등의 상태를 저장
    - 프로그램 카운터 (PC) : 프로세스가 다음에 실행할 명령어 주소
    - CPU 레지스터
    - CPU 스케줄링 정보 : 프로세스의 우선순위, 스케줄 큐에 대한 포인터
    - 메모리 관리 정보 : 페이지 테이블 또는 세그먼트 테이블 등과 같은 정보를 포함
    - 입출력 상태 정보 : 프로세스에 할당된 입출력 장치들과 열린 파일 목록
- 프로세스의 생성과 동시에 고유한 PCB를 생성
- **프로세스는 CPU를 할당 받아 작업을 처리하다가 Context Switching 이 발생하면 진행하던 작업을 저장하고 CPU에 반환 해야 하는데, 이때 진행 상황을 모두 PCB 에 저장**