# 프레임 할당
Demand Paging에서는 프로세스가 당장 수행해야 할 부분에 대해서 최소한의 Frame만을 할당한다.(각 프로세스별 Frame 할당)

## 프레임 할당 방법
### Fixed allocation

- Equal allocation : 모든 프로세스에게 고정된 양의 Frame을 할당하는 방법이다.
    - 예를 들어 100개의 Frame과 5개의 프로세스가 존재한다면 각 프로세스에게 20개의 Frame을 할당한다.
    - 프로세스 크기에 따라 매우 비효율적일 수 있다.
- Proportional allocation : 이 방법은 프로세스의 사이즈에 비례하여 Frame을 할당해주는 방법이다.
    - 프로세스 크기가 크더라도 모든 기능을 사용하지 않기 때문에 비효율적일 수 있다.
- 두 방법 모두 한계가 있다.

### Priority allocation
우선순위 할당은 말 그대로 우선순위가 높은 프로세스에게 더 많은 양의 Frame을 할당해주는 방법이다.
우선순위가 높은 프로세스에 보다 많은 Frame을 할당해주게 된다면 Page fault 횟수는 그만큼 감소하게 되고 프로세스는 작업을 빨리 마친다.
즉, 우선순위가 높은 프로세스가 작업을 빨리 마치게끔 하여 Frame을 반환하여 Frame의 순환율을 높이기 위한 방법이다.

1. **Working Set Model**

    Locality 성질을 사용해서 특정 시간에 따라 사용하는 페이지의 개수 만큼 프레임을 할당 해준다.

    - 사용하는 페이지의 개수 만큼 프레임을 할당해 줄 수 있다.
    - but 미리 수행 해봐야 할 수 있기 때문에 비현실적이다.

        → 따라서 나온 방법이 working set이다.
    - 미래가 아닌 과거를 보는 것

    ![1](https://user-images.githubusercontent.com/33089715/117959188-b890f880-b356-11eb-97cf-2de03be2c7ba.png)

    - working set : **현재 시간에서 일정시간 이전동안 사용되었던 페이지의 집합**. 일정시간의 기준은 운영 체제 내부에서 정하는 기준에 따라 다르며, 이를 working set window 라 한다. 마지막으로 working set 의 개수만큼 프레임 할당
    - 현재 시간이 t_1이라면 working set = {1,2,5,6,7}이다. 이 때 working set 의 개수는 총 5개이므로 프레임 역시 5개를 할당해주면 된다.

2. **Page-Fault Frequency(PFF)**

    - 페이지 부재의 비율은 프로세스에 할당된 프레임의 수에 반비례 한다.

    ![2](https://user-images.githubusercontent.com/33089715/117959199-ba5abc00-b356-11eb-8676-051719e536ce.png)

    세로축 : 페이지 부재 비율, 가로축 : 할당된 프레임의 수

    - 운영 체제 내부에서 해당 프로세스의 페이지 부재 횟수를 계속 검사한다. 여기서 상한선(upper bound)와 하한선(lower bound)를 설정한다.
    - 상한선 보다 많은 페이지 부재가 발생하면 프레임을 더 많이 할당해주고 하한선보다 적게 페이지 부재가 발생하면 할당된 프레임 개수를 줄여준다.

## Thrashing(스레싱)이란?
일반적으로 메모리에 올라가는 프로세스 개수가 증가할 수록 CPU의 이용률은 올라갈 것이라 예상되지만, 어느 정도 범위를 넘어서면 **I/O 작업(페이지교체)이 증가하여 CPU 이용률이 떨어지는 현상**을 말한다.

![5](https://user-images.githubusercontent.com/33089715/117956823-5fc06080-b354-11eb-8d46-78bb1713e405.png)

### 스레싱의 원인?

- 프로세스가 증가할 수록 메인 메모리의 비어있는 프레임 개수는 줄어들게 되고 결국 모든 프레임이 가득 찬다.
- 그 후에도 계속 프로세스가 증가하면 **메모리와 backing store 사이에 page in/out 작업**이 발생하게 되는데, 프로세스가 많아질 수록 이 작업 역시 증가한다.
- **page in/out 은 디스크 I/O 작업으로 CPU 를 사용하지 않는 작업**이다. 그러므로 이 작업이 많아질 수록 CPU는 그 동안 아무것도 하지 않게 된다.

### 스레싱 해결 방법

- 프로세스당 **충분한/적절한 수의 프레임(메모리)를 할당**한다.
- working-set model, PFF Algorithm